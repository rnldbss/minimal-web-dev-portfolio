---
// Import PortableText component
import { PortableText } from "astro-portabletext";

// Define custom types for fragment components
interface BlockProps {
  Component: (props: any) => JSX.Element;
  props: { node: any };
  children: any;
}

interface ListProps {
  Component: (props: any) => JSX.Element;
  props: { type: string };
  children: any;
}

interface MarkProps {
  Component: (props: any) => JSX.Element;
  props: Record<string, any>;
  children: any;
}

// Tailwind classes for headings
const headingClasses: Record<string, string> = {
  h1: "text-5xl pb-2 pt-8 font-pp-neue-montreal",
  h2: "text-3xl pb-2 pt-8 font-pp-neue-montreal",
  h3: "text-2xl pb-2 pt-8 font-pp-neue-montreal",
  h4: "text-xl pb-2 pt-8 font-pp-neue-montreal",
};
---

<PortableText value={Astro.props.content}>
  <!-- 📝 Block Elements -->
  <fragment slot="block">
    {
      ({ Component, props, children }: BlockProps) => {
        const { node } = props;

        if (["h1", "h2", "h3", "h4"].includes(node.style)) {
          const text =
            node.children?.map((child: any) => child.text).join("") || "";
          const id = text.toLowerCase().replace(/\s+/g, "-");
          const Tag = node.style as keyof JSX.IntrinsicElements;

          return (
            <Tag id={id} class={headingClasses[node.style]}>
              {children}
            </Tag>
          );
        }

        return (
          <Component {...props} class="mb-2 md:mb-3">
            {children}
          </Component>
        );
      }
    }
  </fragment>

  <!-- ✅ Lists (Ordered & Unordered) -->
  <fragment slot="list">
    {
      ({ Component, props, children }: ListProps) => {
        const listClass =
          props.type === "bullet"
            ? "list-decimal list-inside mb-[1.4em]"
            : "list-disc list-inside mb-[1.4em]";

        return (
          <Component {...props} class={listClass}>
            {children}
          </Component>
        );
      }
    }
  </fragment>

  <!-- 🔖 Inline Marks (Bold, Italics, etc.) -->
  <fragment slot="mark">
    {
      ({ Component, props, children }: MarkProps) => (
        <Component {...props}>{children}</Component>
      )
    }
  </fragment>
</PortableText>
